\documentclass[12pt]{article}
\usepackage[utf8]{inputenc}

\title{Posterial distribution generation}
\author{}
\date{}

\usepackage[margin=1in]{geometry}
\usepackage{indentfirst}
\usepackage{amsmath} %Math
\usepackage{enumerate}
\usepackage{amssymb}

\begin{document}
\maketitle


\section{The model:}

The main model is: 
    $$Y_{i}(t+6) =\beta_{0,i}+x_{i,1}\beta_{1,i} +
x_{i,2} \beta_{2,i} + x_{i,3}\beta_{3,i} +\beta_{4,i}Y_{i}(t)$$
$$ + \beta_{5,i}\Delta_{i,1}(t)+\beta_{6,i}\Delta_{i,2}(t) +\beta_{7,i}\Delta_{i,3} + \epsilon_{i}(t)$$

(NOTE: omit $j$ as we dont know what it is for now)

\begin{enumerate} 
    \item $x_{i,1}$ is the month of year when the hurricane started
    \item $x_{i,2}$ is the calendar year of the hurricane
    \item $x_{i,3}$ is the type of hurricane
    \item $\Delta_{i,1}(t)$, $\Delta_{i,2}(t)$ and $\Delta_{i,3}(t)$ is the change of latitude longitude, and wind speed between $t-6$ and $t$
    \item $\epsilon_{i,t}$ follows a normal distributions with mean zero and variance $\sigma^2$, independent across $t$
\end{enumerate}

\section{Distributon and priors:}
    Marginal distributions:
    \begin{align*}
        f((Y_{i,t+6})|\mu_i, \sigma) &\sim N(\mu_{i,t},\sigma^2) \\
        \boldsymbol{\beta}_{i} &\sim N(\boldsymbol{\beta}, \boldsymbol{\Sigma}) 
    \end{align*}
    
    Priors:
    \begin{align*}
        f(\sigma^2) &\propto \frac{1}{\sigma^2}\\
        f(\boldsymbol{\beta}) &\propto 1 \\
        f(\boldsymbol{\Sigma}^{-1}) &\propto |\Sigma|^{-d-1} \exp\{-\frac{1}{2}\boldsymbol{\Sigma}^{-1}\} 
    \end{align*}

\section{Hierarchical model structure:}

    Denote $\boldsymbol{Y} = \{Y_{i,t}\}, i = 1,2,\dots,n , t = 1,2,\dots, t_i$.
    
    Hierarchical model will be:
    \begin{align*}
        f(\boldsymbol{\beta},\boldsymbol{\beta_i}, \boldsymbol{\Sigma}^{-1},\sigma^2|\boldsymbol{Y}) &\propto f(\boldsymbol{Y}|\boldsymbol{\beta_i}, \sigma^2) f(\boldsymbol{\beta_i}|\boldsymbol{\beta}, \boldsymbol{\Sigma}^{-1})f(\boldsymbol{\beta})f(\boldsymbol{\Sigma}^{-1})f(\sigma^2)\\
        f(\boldsymbol{Y}|\boldsymbol{\beta_i}, \sigma)&\propto \prod^n_{i=1}\prod^{t_i}_{t=1} \sigma^{-1}\exp\{{-\frac{(Y_{i,t} - \mu_{i,t})^2}{2\sigma^2}\}} \\
        f(\boldsymbol{\beta_i}|\boldsymbol{\beta}, \boldsymbol{\Sigma}^{-1}) &\propto \prod^n_{i=1}\frac{1}{\sqrt{|\boldsymbol{\Sigma}|}} \exp \{ -\frac{1}{2} (\boldsymbol{\beta_i} - \boldsymbol{\beta})^T\boldsymbol{\Sigma^{-1}}(\boldsymbol{\beta_i} - \boldsymbol{\beta})\} 
        \end{align*}

        After put all element into the formula, the full posteria will be the mutiplication of all terms


\section{Posterior Distribution Inference:}


1. For $\pi(\boldsymbol{\beta_i}|.):$

Let:
$$\boldsymbol{Y_i} = (Y_{i,1}, Y_{i,2}, \dots, Y_{i,t_i})^T$$
$$\boldsymbol{X_i} = \begin{bmatrix}
    x_{i,1,1} & x_{i,2,1} & \dots & x_{i,8,1}\\
    x_{i,1,2} & x_{i,2,2} & \dots & x_{i,8,2}\\
    \vdots & \vdots & \ddots &\vdots\\
    x_{i,1,t_i} & x_{i,2,t_i} & \dots & x_{i,8,t_i} \\
\end{bmatrix}_{t_i \times 8}$$

The posteria will be:
\begin{align*}
    \pi(\boldsymbol{\beta_i}|.) &\propto f(\boldsymbol{Y_i}|\boldsymbol{\beta_i}, \sigma^2) f(\boldsymbol{\beta_i}|\boldsymbol{\beta}, \boldsymbol{\Sigma}^{-1}) \\
    &\propto \prod^{t_i}_{t=1} \bigg(\sigma^{-1}\exp\{{-\frac{(Y_{i,t} - \mu_{i,t})^2}{2\sigma^2}\}}\bigg)\bigg(\frac{1}{\sqrt{|\boldsymbol{\Sigma}|}} \exp \{ -\frac{1}{2} (\boldsymbol{\beta_i} - \boldsymbol{\beta})^T\boldsymbol{\Sigma^{-1}}(\boldsymbol{\beta_i} - \boldsymbol{\beta})\} \bigg) \\
    &\propto \exp\{-\frac{1}{2}\bigg(\sum_{t = 1}^{t_i}\sigma^{-2}(Y_{i,t} - \boldsymbol{X_{i,t}}\boldsymbol{\beta_i})^2 + (\boldsymbol{\beta_i}-\boldsymbol{\beta})^T\boldsymbol{\Sigma^{-1}}(\boldsymbol{\beta_i} - \boldsymbol{\beta})\bigg)\} \\
    &\propto  \exp\{-\frac{1}{2}\bigg((\boldsymbol{Y_{i}} - \boldsymbol{X_{i}}\boldsymbol{\beta_i})^T(\sigma^{-2}\boldsymbol{I}_{t_i \times t_i})(\boldsymbol{Y_{i}} - \boldsymbol{X_{i}}\boldsymbol{\beta_i}) + (\boldsymbol{\beta_i}-\boldsymbol{\beta})^T\boldsymbol{\Sigma}^{-1}_{8 \times 8}(\boldsymbol{\beta_i} - \boldsymbol{\beta})\bigg)\} \\
    &\propto \exp\{-\frac{1}{2}((\sigma_i^2(X_i^TX_i)^{-1}) + \Sigma^{-1})^{-1}]((X_i^TX_i)^{-1}\Sigma^{-1}\boldsymbol{\beta} + I\sigma_i^{-2}X_i^TY_{it}))^T((\sigma_i^2(X_i^TX_i)^{-1} + \Sigma^{-1})\\
    &((X_i^TX_i)^{-1}\Sigma^{-1}\beta + I\sigma_i^{-2}X_i^TY_{it}))\}
\end{align*}

So: 
$$\boldsymbol{\beta_i} \sim N(\boldsymbol{K}((X_i^TX_i)^{-1}\Sigma^{-1}\boldsymbol{\beta} + \sigma^{-2}X_i^TY_{i}), K)$$

where:  $$K = ((X_i^TX_i)^{-1}\Sigma^{-1} + \sigma^{-2}(X_i^TX_i)^{-1})^{-1}$$

$$\propto \exp\{-\frac{1}{2}((\sigma_i^2(X_i^TX_i)^{-1}) + \Sigma^{-1})^{-1}]((X_i^TX_i)^{-1}\Sigma^{-1}\boldsymbol{\beta} + I\sigma_i^{-2}X_i^TY_{it}))^T((\sigma_i^2(X_i^TX_i)^{-1} $$

$$+ \Sigma^{-1})((X_i^TX_i)^{-1}\Sigma^{-1}\beta + I\sigma_i^{-2}X_i^TY_{it}))\}$$

2.For $\pi(\sigma^2|.):$
\begin{align*}
    \pi(\sigma^2|.) &= \propto f(\boldsymbol{Y}|\boldsymbol{\beta_i}, \sigma^2) \cdot \pi(\sigma^2) \\
    &\propto \bigg(\prod^n_{i=1}\prod^{t_i}_{t=1} \sigma^{-1}\exp\{{-\frac{(Y_{i,t} - \mu_{i,t})^2}{2\sigma^2}\}} \bigg)\frac{1}{\sigma^2}\\
&\propto (\sigma^2)^{-1-\frac{\sum t_i}{2}}\prod^n_{i=1}\prod^{t_i}_{t=1} \exp\{{-\frac{(Y_{i,t} - \mu_{i,t})^2}{2\sigma^2}\}} \\
&\propto \sigma^{-2-\sum t_i}exp{\{-\frac{1}{2}\sum^n_{i=1}\sum^{ti}_{t=1}(Y_{i,t} - \mu_{i,t})^2\sigma^{-2}\}} \\
\end{align*}

where, 
$$\sigma^2 \sim InvGamma(\frac{\sum t_i}{2}, \frac{SSR}{2})$$ 

$$SSR = \sum^n_{i=1}\sum^{ti}_{t=1}(Y_{it} - X_i\beta_i)^T(Y_{it}- X_i\beta_i)$$

3. $\Sigma^{-1}|.$:
$$\pi(\Sigma^{-1}|.) = \prod^n_{i=1} \pi(Y_{it}|\beta_i,\beta, \Sigma^{-1}, \sigma^2) \cdot \pi(\beta_i|\beta, \Sigma^{-1})\cdot \pi(\Sigma^{-1})$$
$$\propto \Sigma^{-n}exp{\{-\frac{1}{2}\sum^n_{i=1}(\beta_i-\beta)^T\Sigma^{-1}(\beta_i-\beta)\}}\cdot|\Sigma|^{-(d+1)}exp{\{-\frac{1}{2}\Sigma^{-1}\}}$$
$$\propto \Sigma^{-(n/2+d+1)}exp{\{-\frac{1}{2}(\sum^n_{i=1}(\beta_i-\beta)^T(\beta_i-\beta)+1)n\Sigma^{-1}\}}$$
$$\Sigma^{-1} \sim InvWhishart(\frac{n}{2}, nSSR_{\beta_i}),\ where\ SSR_{\beta_i} = \sum^n_{i=1}((X_i^TX_i)^{-1}\beta_i - (X_i^TX_i)^{-1}\beta)^2$$

4. $\beta|.$: 
$$\pi(\beta|.) = \pi(Y_{it}|.)\cdot \pi(\beta_i|.) \cdot \pi(\beta) \propto \pi(\beta_i|.)$$
$$\propto exp{\{\frac{1}{2}\sum^n_{i=1}((X_i^TX_i)^{-1}(\beta_i - \beta))^T((X_i^TX_i)^{-1}(\beta_i - \beta))((X_i^TX_i)^{-1}\Sigma^{-1})\}}$$
$$\beta \sim N(\hat{\beta_i}, \Sigma^{-1}((X_i^TX_i)^{-1}),\ where\ \hat{\beta} = (X_i^TX_i)^{-1}X_i^TY_{i}$$
Or, according to the Central Limit Theorem,
$$\frac{\beta_i - \beta}{\sqrt{\Sigma^{-1}/n}},\ \beta = \bar{\beta_i}\ \text{for}\ i = 1, 2,...,n$$




\end{document}